const BASE_URL="https://cwbnutrishop.oulrum.workers.dev/",sku=document.querySelector("div.codigo-produto span[itemprop='sku']").textContent,skuReference=document.querySelector("#descricao [ref]").textContent,attributesContainer=document.querySelector(".atributos"),attrComboboxes=0<attributesContainer?.querySelectorAll(".wrapper-dropdown").length?attributesContainer?.querySelectorAll(".wrapper-dropdown"):["","",""],btnsBuy=document.querySelectorAll(".botao-comprar");let kitChoices;const item={};async function getFetch(a){const b=await fetch(a),c=await b.json();return c}async function getStock(a){const b=await getFetch(`${BASE_URL}api/stock?id=${a}`);return b.quantidade}async function getVariations(a,b){const c=[],d=[];item.grades=[];const e=a[0].split("/")[4];item.grades.push(e);const f=await getFetch(`${BASE_URL}api/grades?id=${e}`);for(let d of b){const a=d.split("/")[4],b=await getFetch(`${BASE_URL}api/product?id=${a}`);c.push({resource_uri:b.variacoes[0],id:a,active:b.ativo})}const g=f.variacoes.filter(a=>c.some(b=>b.resource_uri===a.resource_uri));for(let f of g){const a=c.filter(a=>a.resource_uri===f.resource_uri)[0],b=await getStock(a.id);d.push({id:a.id,id_grade:e,name:f.nome,active:a.active,stock:b})}return d}async function getChoices(){const a=[],b=await getFetch(`${BASE_URL}api/product?sku=${skuReference}`);if(!b.objects||0===b.objects.length)return void console.error("Produto n\xE3o encontrado.");const c=b.objects[0],d={name:c.nome,url:c.url,sku:c.sku,active:c.ativo,variations:await getVariations(c.grades||[],c.filhos||[])};for(let b=0;b<attrComboboxes.length;b++)a.push(d);const e=document.createElement("template");e.id="__KITDATA__",e.innerHTML=JSON.stringify(a),document.head.appendChild(e),kitChoices=document.createElement("kit-choices"),attributesContainer.appendChild(kitChoices)}function arrayToUrlParams(a,b=1){return a.map(a=>`${a}=${b}`).join("&")}function validateValues(){const a=document.querySelector("input[name='qtde-carrinho'");kitChoices.itemsSelected.length!=attrComboboxes.length||btnsBuy.forEach(b=>{b.href=`https://www.cwbnutrishop.com/carrinho/produto/adicionar?${arrayToUrlParams(kitChoices.itemsSelected,a.value)}`})}addEventListener("load",async()=>{attributesContainer&&sku.includes("KIT")&&(attributesContainer.innerHTML="",btnsBuy.forEach(a=>{a.href="javascript:void(0)"}),await getChoices(),kitChoices.addEventListener("change",validateValues))});